#ä»£ç è§£é‡Šï¼šhttps://lxblog.com/qianwen/share?shareId=e0d19615-7ace-4a99-98c0-23f18d2675bf
# å¯æ‰§è¡Œæ–‡ä»¶åå­—è‡ªå–ï¼Œè¿™é‡Œå« cmake_demoï¼Œæ–°å»ºé¡¹ç›®éœ€è¦æ”¹å
set(TARGET_NAME thread_singleton)

# ğŸ‘‡ æ–°å¢ï¼šç›‘æ§ include/ ä¸‹æ‰€æœ‰å¤´æ–‡ä»¶ï¼Œè§¦å‘é‡æ–°é…ç½®
file(GLOB_RECURSE lib_headers CONFIGURE_DEPENDS
     ${CMAKE_CURRENT_SOURCE_DIR}/include/*.h
     ${CMAKE_CURRENT_SOURCE_DIR}/include/*.hpp)

# â‘  æ”¶é›†åº“æºç ï¼ˆä¸å« main.cppï¼‰
file(GLOB_RECURSE lib_srcs CONFIGURE_DEPENDS
     ${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp)
list(FILTER lib_srcs EXCLUDE REGEX ".*main\\.cpp$")

# ğŸ‘‡ æ–°å¢ï¼šåˆ¤æ–­æ˜¯å¦æœ‰åº“æºæ–‡ä»¶ï¼Œæœ‰æ‰åˆ›å»ºåº“
if(lib_srcs)
    # â‘¡ å»ºé™æ€åº“
    add_library(${TARGET_NAME}_lib STATIC ${lib_srcs})
    target_include_directories(${TARGET_NAME}_lib
        PUBLIC
            $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
            $<INSTALL_INTERFACE:include>
    )

    if(CMAKE_CXX_COMPILER_ID MATCHES "GNU|Clang")
        target_compile_options(${TARGET_NAME}_lib PRIVATE -Wall -Wextra -Wpedantic)
    endif()
endif()

# â‘¢ å¯æ‰§è¡Œæ–‡ä»¶
add_executable(${TARGET_NAME} src/main.cpp)

# ğŸ‘‡ æ–°å¢ï¼šæ— è®ºæœ‰æ²¡æœ‰åº“ï¼Œmain.cpp éƒ½éœ€è¦è®¿é—® include/ ä¸‹çš„å¤´æ–‡ä»¶ï¼
target_include_directories(${TARGET_NAME} PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/include)

# ğŸ‘‡ æ–°å¢ï¼šå¦‚æœåº“å­˜åœ¨ï¼Œæ‰é“¾æ¥
if(TARGET ${TARGET_NAME}_lib)
    target_link_libraries(${TARGET_NAME} PRIVATE ${TARGET_NAME}_lib)
endif()